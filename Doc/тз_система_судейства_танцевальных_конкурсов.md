# Техническое задание: Система для судейства танцевальных конкурсов

**Дата:** 04.12.2025

**Цель:** разработать удобную, быструю и доступную систему для выставления оценок судьями на танцевальных конкурсах. Система должна поддерживать как отборочные туры (этапы 1–8, 1–4, 1–2), так и финалы, различные категории участников, группировку по заходам и дать возможность автоматического подсчёта результатов и экспорта протоколов.

---

## 1. Краткое описание требований

1. Поддерживаемые варианты доступа:
   - Основной: Web-приложение (адаптивное под мобильные устройства).
   - Вспомогательно: Telegram-бот для авторизации, уведомлений и быстрого доступа к ссылкам.

2. Роли пользователей:
   - Главный судья (администратор): набор прав — создание соревнования, управление этапами, просмотр и экспорт протоколов, управление пользователями.
   - Судья: выставление оценок, просмотр собственного журнала оценок, получение уведомлений.
   - Секретарь / Оператор: ввод и корректировка результатов при очных исправлениях (по правам главного судьи).
   - Наблюдатель/Зритель (опционально): просмотр итогов в реальном времени (read-only).

3. Категории участников:
   - Начинающие (любители), Дебютанты — оценки по 3 критериям: музыкальность, техника, взаимодействие (для партнёров: ведение / следование как отдельный критерий при необходимости).
   - Профессионалы, Мастера — двухраундовая система: раунд 1 — пары участники друг с другом; раунд 2 — участники танцуют с судьями. Судьи ставят места (1..N, обычно 1..5). Итог — по сумме мест (минимальная сумма = 1-е место).

4. Оценки и шкалы:
   - Отборочные: баллы 0–10 (целые или с шагом 0.1 — опционально). Поддержка отрицательных значений не требуется.
   - Финалы (любители): 0–10 по каждому критерию. Итоговый балл = сумма/среднее по критериям (в ТЗ указать способ агрегации).
   - Финалы (профи/мастера): судьи выставляют **места** (1..M). Итог — суммирование мест; при равенстве — правило тай-брейка (см. раздел 6).

5. Группировка по заходам:
   - Автоматическое распределение участников по заходам в зависимости от общего количества зарегистрировавшихся и заданного максимального размера захода.
   - Возможность вручную корректировать группы.

6. Протоколы и экспорт:
   - Экспорт в Excel (.xlsx) и PDF для каждого этапа/категории.
   - Отправка итоговых таблиц в Google Sheets (опционально, через OAuth).

7. Безопасность и доступ:
   - Авторизация через персональную ссылку + проверка по Telegram ID (если используется бот) или через логин/пароль.
   - Ролевой доступ к функционалу.
   - Логи действий (кто и когда изменял оценки).

---

## 2. Функциональные требования (детально)

### 2.1 Конфигурация соревнования
- Создание соревнования: название, дата, место, контактные данные.
- Добавление категорий и подкатегорий (Начинающие, Дебютанты, Профи, Мастера и т. д.).
- Задание набора критериев для каждой категории (например, музыкальность, техника, взаимодействие, ведение/следование).
- Настройка этапов: отборочные (указывать тип 1–8, 1–4, 1–2), финал, количество заходов по умолчанию, максимальное число участников в заходе.

### 2.2 Управление участниками
- Импорт участников через Excel/CSV.
- Ручная регистрация участника (ФИО, номер, пол, партнёр/партнёрша, категория).
- Перенос участников между заходами и этапами.

### 2.3 Интерфейс судьи (Web)
- Страница входа (персональная ссылка или логин).
- Список этапов и заходов, назначенных этому судье.
- Для каждого участника — форма для ввода оценок:
  - Для любителей: поля для каждого критерия (0–10).
  - Для профи/мастеров: поле “место” (1..M).
- Быстрые горячие клавиши (опционально) для ввода оценок на клавиатуре.
- Возможность сохранения промежуточных результатов и редактирования до завершения захода.

### 2.4 Интерфейс главного судьи / администратора
- Панель управления: создание этапов, распределение участников, просмотр прогресса судей.
- Таблица результатов в реальном времени с возможностью сортировки и фильтрации.
- Механизм блокировки/разблокировки оценок после подтверждения захода.
- Логи правок и отмен.

### 2.5 Telegram-бот (вспомогательно)
- Команды:
  - /start — приветствие и запрос авторизации.
  - /login — привязка Telegram ID к судье (через персональный код).
  - /mytasks — список заходов, где судья назначен, и ссылка на web-форму.
  - Уведомления о следующем заходе, тайминге, изменениях.
- Бот не хранит сложные данные — пересылает только ссылки и уведомления; основная работа в Web.

---

## 3. Нефункциональные требования
- Адаптивность: полноценная работа в мобильных браузерах.
- Отказоустойчивость: автосохранения каждой оценки (через API) с подтверждением сохранения.
- Производительность: одновременная работа до 100 судей и 1000 участников (оценка нагрузки и масштабирование отдельно).
- Совместимость: современные браузеры (Chrome, Safari, Edge, Firefox).
- Локализация: русский интерфейс; возможность добавлять другие языки в дальнейшем.

---

## 4. Бизнес-правила и алгоритмы подсчёта

### 4.1 Отборочные (любители)
- Оценки по критериям 0–10.
- Итоговый балл участника = сумма всех критериев (или среднее — опция, указываем в настройках соревнования).
- При отсутствии оценки от какого-либо судьи — используется средняя оценка других судей (или оценка по умолчанию) — выбирается в настройках.

### 4.2 Финал (любители/debutants)
- Оценки 0–10 по трём критериям.
- Итог: отображается как сумма и как среднее (для удобства).
- Ранжирование по итоговой сумме; при равенстве — сравнение по отдельным критериям по приоритету (например, музыкальность → техника → взаимодействие). Если и после этого равенство — делается тай-брейк по решению главного судьи или среднему месту.

### 4.3 Финал (профи/мастера)
- Каждый судья выставляет место (1..M) в каждом из двух туров.
- Для каждого участника суммируются места от всех судей и за оба тура (если регламент требует суммировать оба тура отдельно, настраиваемым сделать).
- Ранг участника определяется по минимальной сумме мест.
- Тай-брейк: в случае равенства суммы мест — сравниваются места в туре 2 (или другое правило, настраиваемое); если и это равно — применяется правило «меньше штрафных мест» или решение главного судьи.

---

## 5. UI/UX — ключевые экраны (кратко)
1. Экран логина/авторизации.
2. Дашборд судьи: список активных заходов, время, кнопка «Перейти к оцениванию».
3. Форма оценки одного захода: список участников + поля критериев + кнопка сохранить.
4. Дашборд главного судьи: live-таблица результатов, панель управления этапами.
5. Экспорт/отчёты: кнопки экспорта в Excel/PDF/Google Sheets.

---

## 6. Администрирование
- Управление судьями (создание, активация/деактивация, назначение на заходы).
- Возможность правки оценок с логом изменений.
- Резервные копии баз данных и экспорт всей информации.

---

## 7. Техническая архитектура (предложение)
- Frontend: React (TypeScript), адаптивная верстка.
- Backend: Node.js (Express) / Python (FastAPI) — на выбор.
- БД: PostgreSQL.
- Реальное время: WebSocket (для live-таблицы) или polling каждые N секунд.
- Хостинг: облачный VPS или PaaS (Heroku/Render/AWS Elastic Beanstalk). Использовать HTTPS.
- Интеграции: Telegram Bot API, Google Sheets API (опционально).

---

## 8. Формат данных / пример сущностей
- User { id, name, role, telegram_id, email }
- Competition { id, name, date, settings }
- Category { id, competition_id, name, criteria[] }
- Participant { id, name, number, partner_id, category_id }
- Heat (заход) { id, category_id, number, participants[] }
- Score { id, judge_id, participant_id, heat_id, values: {criterion_id: score}, timestamp }
- Place { id, judge_id, participant_id, round, place }

---

## 9. Тестирование и приёмка
- Unit-тесты для ключевых алгоритмов подсчёта.
- Интеграционные тесты API.
- Пользовательское тестирование: 2 репетиции-«боев» с настоящими судьями.
- Acceptance criteria:
  - Все судьи могут войти и выставить оценки.
  - Результаты обновляются в реальном времени в дашборде главного судьи.
  - Экспорт протоколов генерируется корректно.

---

## 10. Дополнительно — сценарии и примеры
1. **20 участников, заходы по 10**: система автоматически разбивает список на 2 захода.
2. **30 участников, заходы по 7**: система создаёт 5 заходов (4×7 + 1×2) — админ может перераспределить, чтобы равномерно распределить (например, 3×6 + 2×6).
3. **Финал профи 7 участников**: поддержка M=7 мест; если правило предполагает 1..5, система должна позволять изменять диапазон мест под регламент.

---

## 11. Варианты минимальной реализации (MVP)
**MVP-1 (быстрая реализация, 2–3 дня разработки):**
- Web-форма для судей (ввод 0–10), таблица главного судьи, экспорт в CSV.
- Ручное распределение заходов.
- Без Telegram-интеграции, без Google Sheets.

**MVP-2 (расширенный, 1–2 недели):**
- Автоматическое распределение по заходам.
- Telegram-бот (авторизация + уведомления).
- Экспорт в Excel/PDF.
- Поддержка финалов профи с двумя турами и подсчётом по сумме мест.

---

## 12. Acceptance criteria / что должно быть на выходе
1. Рабочая система судейства, доступная по URL и адаптивная под мобильные браузеры.
2. Судьи могут выставлять оценки в режиме реального времени.
3. Главный судья видит live-таблицы и может экспортировать протоколы.
4. Поддержка всех перечисленных категорий и правил подсчёта.

---

## 13. Последующие шаги (рекомендации)
1. Утверждение регламентов (точные правила тай-брейка, шаг оценок — целые или дробные).
2. Согласование уровней доступа для операторов и секретаря.
3. Выбор стека и хостинга.
4. Разработка прототипа интерфейса (вайрфрейм), тестовая репетиция с судьями.

---

_Если хотите, следующими шагами я могу:_
- подготовить **визуальный прототип (wireframe)** ключевых экранов; или
- составить **список API-эндпоинтов** и подробную ER-диаграмму; или
- подготовить **MVP-план разработки** с разбивкой по задачам.

Напишите, что сделать дальше, и я подготовлю следующую артефакт.



---

# 14. Список API-эндпоинтов (черновик)

## 14.1 Авторизация и пользователи
**POST /auth/login** — вход по логину/паролю или коду.
**POST /auth/telegram** — привязка Telegram ID.
**GET /users/me** — получить профиль текущего пользователя.
**POST /users** — создать судью/секретаря/админа.
**GET /users** — список пользователей.
**PATCH /users/{id}** — обновить данные пользователя.

## 14.2 Соревнования
**POST /competitions** — создать соревнование.
**GET /competitions** — список соревнований.
**GET /competitions/{id}** — получить данные соревнования.
**PATCH /competitions/{id}** — обновление настроек.

## 14.3 Категории и критерии
**POST /competitions/{id}/categories** — создать категорию.
**GET /competitions/{id}/categories** — список категорий.
**PATCH /categories/{id}** — обновить категорию.
**POST /categories/{id}/criteria** — добавить критерии.

## 14.4 Участники
**POST /competitions/{id}/participants** — создание участника.
**GET /competitions/{id}/participants** — список участников.
**PATCH /participants/{id}** — обновить данные.

## 14.5 Заходы (Heats)
**POST /categories/{id}/heats/auto** — автоматическое распределение.
**POST /categories/{id}/heats** — создать заход вручную.
**GET /categories/{id}/heats** — список заходов.
**GET /heats/{id}** — данные конкретного захода.
**PATCH /heats/{id}** — обновить состав.
**POST /heats/{id}/lock** — зафиксировать оценки.

## 14.6 Оценки (Scores)
**POST /scores** — сохранить оценки судьи.
**GET /heats/{id}/scores** — получить оценки по заходу.
**GET /participants/{id}/scores** — все оценки участника.

## 14.7 Финалы (места для профи/мастеров)
**POST /final/places** — сохранить место судьи.
**GET /final/{category_id}/results** — итоговое ранжирование.

## 14.8 Экспорт
**GET /export/competition/{id}/excel** — экспорт Excel.
**GET /export/competition/{id}/pdf** — PDF.
**POST /export/google/{id}** — выгрузка в Google Sheets.

## 14.9 Технические эндпоинты
**GET /health** — статус сервера.
**GET /version** — версия API.

---

